meta {
  name: 7. Create Order
  type: http
  seq: 7
}

post {
  url: {{orderServiceUrl}}/api/orders
  body: json
}

headers {
  Authorization: Bearer {{authToken}}
  Content-Type: application/json
}

body:json {
  {
    "restaurantId": "{{testRestaurantId}}",
    "items": [
      {
        "menuItemId": "test-menu-item-1",
        "quantity": 2,
        "unitPrice": 12.99,
        "specialInstructions": "No onions please"
      },
      {
        "menuItemId": "test-menu-item-2",
        "quantity": 1,
        "unitPrice": 8.50,
        "specialInstructions": "Extra cheese"
      }
    ],
    "customerAddress": {
      "street": "123 Test Street",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "country": "USA"
    },
    "specialInstructions": "Ring the doorbell twice",
    "paymentMethod": "CREDIT_CARD"
  }
}

tests {
  test("Order created successfully", function() {
    expect(res.status).to.equal(201);
    expect(res.body).to.have.property('id');
    expect(res.body).to.have.property('status');
    expect(res.body.status).to.equal('PENDING');
    
    // Store order ID for subsequent tests
    bru.setEnvVar("testOrderId", res.body.id);
  });
  
  test("Order contains correct data", function() {
    expect(res.body).to.have.property('items');
    expect(res.body.items).to.be.an('array');
    expect(res.body.items.length).to.equal(2);
    expect(res.body.totalAmount).to.be.a('number');
    expect(res.body.restaurantId).to.equal(bru.getEnvVar("testRestaurantId"));
  });
    expect(res.body.items).to.be.an('array');
    expect(res.body.items.length).to.be.above(0);
    
    // Store order ID for subsequent tests
    bru.setEnvVar("orderId", res.body.order_id);
  });
}