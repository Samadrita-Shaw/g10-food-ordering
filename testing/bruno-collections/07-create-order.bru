meta {
  name: 7. Create Order
  type: http
  seq: 7
}

post {
  url: http://localhost:8083/api/orders
  body: json
  auth: none
}

headers {
  Authorization: Bearer {{authToken}}
  Content-Type: application/json
}

body:json {
  {
    "userId": "{{userId}}",
    "restaurantId": "{{restaurantId}}",
    "totalAmount": 34.48,
    "deliveryFee": 2.99,
    "taxAmount": 2.76,
    "deliveryAddress": {
      "street": "123 Test Street",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "country": "USA",
      "latitude": 40.7128,
      "longitude": -74.0060
    },
    "specialInstructions": "Ring the doorbell twice"
  }
}

tests {
  test("Order created successfully", function() {
    expect(res.status).to.equal(201);
    expect(res.body).to.have.property('id');
    expect(res.body).to.have.property('status');
    expect(res.body.status).to.equal('PENDING');
    
    // Store order ID for subsequent tests
    bru.setEnvVar("orderId", res.body.id);
    expect(res.body.status).to.equal('PENDING');
    
    // Store order ID for subsequent tests
    bru.setEnvVar("testOrderId", res.body.id);
  });
  
  test("Order contains correct data", function() {
    expect(res.body).to.have.property('items');
    expect(res.body.items).to.be.an('array');
    expect(res.body.items.length).to.equal(2);
    expect(res.body.totalAmount).to.be.a('number');
    expect(res.body.restaurantId).to.equal(bru.getEnvVar("testRestaurantId"));
  });
    expect(res.body.items).to.be.an('array');
    expect(res.body.items.length).to.be.above(0);
    
    // Store order ID for subsequent tests
    bru.setEnvVar("orderId", res.body.order_id);
  });
}
